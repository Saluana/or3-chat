# Troubleshooting

Common issues and fixes for the current theme system.

## Quick checks

```bash
# Validate themes + regenerate types
bun run theme:validate

# Build cssSelectors style output
bun run theme:build-css
```

Browser console checks:

```js
localStorage.getItem('activeTheme');
document.documentElement.getAttribute('data-theme');
```

## Theme not applying

1. Ensure the theme exists at `app/theme/<name>/theme.ts`.
2. Set the active theme:

```ts
const { setActiveTheme } = useThemeResolver();
await setActiveTheme('my-theme');
```

3. Confirm components use `v-theme` or `useThemeOverrides`.

## Overrides not working

### Identifier and context mismatch

Remember: `v-theme="'chat.send'"` sets **identifier** only. Context is detected
separately or passed explicitly.

```vue
<UButton v-theme="{ identifier: 'chat.send', context: 'chat' }" />
```

### Context detection

Auto-detection only covers a few containers:

- `#app-chat-container` or `[data-context="chat"]`
- `#app-sidebar` or `[data-context="sidebar"]`
- `#app-dashboard-modal` or `[data-context="dashboard"]`
- `#app-header` or `[data-context="header"]`

For other areas, add `data-context` on a wrapper.

### State selectors

`:hover` and `:active` only match if you pass `state` to the resolver manually.
The directive always uses `state: 'default'`. Use `cssSelectors` for DOM states.

## cssSelectors not applying

1. If you use `style`, run `bun run theme:build-css`.
2. Ensure `<html>` has `data-theme="<name>"`.
3. For lazy components, use `useThemeClasses()` to re-apply runtime classes.

## Theme switching does not persist

Theme selection is stored in `localStorage.activeTheme` and in the
`or3_active_theme` cookie. Private browsing or blocked storage can prevent
persistence.

## TypeScript types missing

Types are generated by `bun run theme:validate` into
`types/theme-generated.d.ts`. Make sure your `tsconfig.json` includes
`types/**/*.d.ts`.

## Light/dark mode issues

Light/dark mode is separate from theme selection:

```ts
const theme = useNuxtApp().$theme;
theme.set('dark');
theme.toggle();
```

## Debugging tips

In dev mode, resolved overrides expose:

- `data-theme-target`
- `data-theme-matches`

You can inspect them in DevTools on themed elements.

To inspect resolver output:

```ts
const { $theme } = useNuxtApp();
const resolver = $theme.getResolver($theme.activeTheme.value);
const props = resolver?.resolve({
  component: 'button',
  context: 'chat',
  identifier: 'chat.send',
});
console.log(props);
```

## Build errors

### Missing default export

Make sure each theme file has a default export:

```ts
export default defineTheme({ name: 'my-theme', colors: { ... } });
```

### Invalid theme name

Theme names must be kebab-case and start with a letter:

```ts
name: 'my-theme' // ok
```
